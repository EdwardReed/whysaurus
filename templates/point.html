{% extends "base.html" %}

{% block mainPageContent %}
  <script type="text/javascript" src="/static/js/point.js"></script>

  {% if user %}
    {% with point.title as pointTitle %}
        {% include 'selectSupportingPointsSearch.html' %}
    {% endwith %}
  {% endif %}

  <div class="row topSpace"></div>
    <div class="dropdown pull-left">
        <button class="dropdown-toggle {% if not supportedPoints %} disabled {% endif %}" id="supportedByMeMenu" data-toggle="dropdown">
         {% if not supportedPoints %} none {% else %} {{ supportedPoints|length }} {% endif %} supported
        </button>
          <ul class="dropdown-menu" role="menu" aria-labelledby="supportedByMeMenu">
              {% for supPoint in supportedPoints %}
                  <li><a tabindex="-1"
                  alt="View {{ supPoint.title|escape }}"
                  href="/point/{{ supPoint.url }}">{{supPoint.title|escape}}</a></li>
              {% endfor %}
          </ul>
     </div>
     <div class="dropdown pull-left">
        <button class="dropdown-toggle {% if not counteredPoints %} disabled {% endif %} "
        id="counteredByMeToggle" data-toggle="dropdown">
         {% if not counteredPoints %} none {% else %} {{ counteredPoints|length }} {% endif %} countered
        </button>
        <ul class="dropdown-menu" role="menu" aria-labelledby="counteredByMeMenu">
              {% for cnPoint in counteredPoints %}
                  <li><a tabindex="-1"
                  alt="View {{ cnPoint.title|escape }}"
                  href="/point/{{ cnPoint.url }}">{{cnPoint.title|escape}}</a></li>
              {% endfor %}
          </ul>
     </div>
  <div class="row">
    <div id="pointArea" class="boxedElement span12 dropShadow">
      <div id="scoreAndVotingSection" class="span1 pagination-centered">
        <div class="row-fluid" id="wellWritten">Well written?</div>
        <div class="row-fluid">       
          <div id="blueRibbon" class="span6"
              data-ribbonvalue="{{ribbonValue|lower}}">
            <a class="{% if ribbonValue %} awarded {% else %} notAwarded {% endif %}"
              alt="Award Ribbon" src="/static/img/blueribbon.png"> </a>   
          </div>                                                      
          <div id="ribbonTotal" class="span6">{{point.ribbonTotal}}</div>
        </div>

				<div id="bigScore" class="{% if point.voteTotal >= thresholds.green %}
							greenScore
						{% else %}
							{% if point.voteTotal <= thresholds.red %}
								redScore
							{% else %}
								yellowScore
							{% endif %}
						{% endif %} hugeScore">
					{{ point.voteTotal }}</div>

                <div id="upVote" class= "voteArea upArrow whiteScoreText {% if voteValue == 1 %} greenVote {% else %} inactiveVote {% endif %}" >
                  <a alt="UpVote" >{{point.upVotes}}</a> AGREE
                </div>
                <div id="downVote" class= "voteArea downArrow whiteScoreText {% if voteValue == -1 %} redVote {% else %} inactiveVote {% endif %}" >
                  <a alt="DownVote">{{point.downVotes}}</a> DISAGREE
                </div>
                
                <div id="voteLabel" class="columnHeading">
                    {% if voteValue == -1 %} 
                        You Disagree 
                    {% else %} 
                        {% if voteValue == 1 %}
                           You Agree
                        {% else %}
                           You Abstain
                        {% endif %}
                    {% endif %}                    
                </div>
                

       </div>
      <div id="pointSummary" class="span7">
                <div class="mainPointTitle editable"><h1 class="condensed">{{ point.title|escape }}</h1></div>
				<div class="mainPointContent editable">{{ point.content|safe }}</div>
                <!-- Hacky way to get imageurl into the edit dialog. :/ -->
                <div class="mainPointImageURL" style="display: none">{{point.imageURL}}</div>
                {% include 'sources.html' %}

        </div>
	  <div id="timestampAndEditLink" class="span8">
			<div class="span1"></div>
			<div class="mainPointLastEdited">
				Last edited {{point.PSTdateEdited}} by <a href='/user/{{point.authorURL}}'>{{ point.authorName }}</a>
			</div>
			<button class="mainPointButton" id="editPoint">
				edit
			</button>
      </div>
      <div id="mainPointImageArea" class="span3">
            {% if point.imageURL and point.imageURL.strip %}
              <img class="pointDisplay" src="{{ point.fullPointImage }}" />
              <div class="mainPointImageCaption">{{point.imageDescription}}</div>
              <div class="mainPointImageAuthor">{{point.imageAuthor}}</div>
              <button class="mainPointButton" id="changeImage">change image</button>
            {% else %}
              <img class="pointDisplay" src="/static/img/placeholder.gif" />
              <div class="mainPointImageCaption">{{point.imageDescription}}</div>
              <div class="mainPointImageAuthor">{{point.imageAuthor}}</div>
              <button class="mainPointButton" id="addImage">add an image</button>
            {% endif %}
        </div>
	  <div class="row">
          <div class="grayBackground span12">
			 <div class="span1"></div>
			 <div class="span8">
			    <button class="mainPointButton tab selectedTab" id="viewSupportingPoints">
					connections
				</button>
			    <button class="mainPointButton tab" id="viewComments">
					{{comments|length}} comments
				</button>
	            <button class="mainPointButton tab" id="viewPointHistory">
					history
				</button>
	         </div>
             <div id="sharing" class="span1">
                <div class="addthis_toolbox addthis_default_style" addthis:url="{{point.url}}" addthis:title="{{point.title}}">
                  <a class="addthis_button_facebook"></a>
                  <a class="addthis_button_twitter"></a>
                  <a class="addthis_button_email"></a>
                  <!-- <a class="addthis_button_print"></a> -->
                  <a class="addthis_button_compact"></a>
                  <!-- <a class="addthis_counter addthis_bubble_style"></a> -->
                </div>
             </div>
			 <div class="rightMainPointButtons span2">
	           {% if user.admin %}
                <div class="dropdown">             
                     <button class="dropdown-toggle mainPointButton" id="pointAdminMenu" data-toggle="dropdown">
                        Admin
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="pointAdminMenu">
                          <li><a tabindex="-1"
                          alt="Delete Point"
                          id="deletePoint" onClick="javascript:deletePoint('{{point.url}}');">Delete</a></li>
                          <li><a href='/job/cleanDeadBacklinks/{{point.url}}'>Root Backlink Clean</a></li>
                          <li><a href='/job/reconcileVersionArrays/{{point.url}}'>Version Array Fix</a></li>
                          <li><a href='/job/addMissingBacklinks/{{point.url}}'>Add Missing Backlinks</a></li>
                          
                    </ul>
	             </div>
               {% endif %}
		    </div>
		  </div>
	  </div>
	</div>
  </div>


  <div id="supportingPointsArea" class="tabbedArea">
        <div class="row">
            <div class="span6">
              {% with recentlyViewedPoints as recentlyViewedPoints  %}
                {% with supportingPoints as linkedPoints %}
                {% with "supporting" as linkType %}
                    {% include 'linkPointsList.html' %}
                {% endwith %}
                {% endwith %}
            </div>
            <div class="span6">
                {% with counterPoints as linkedPoints %}
                {% with "counter" as linkType %}
                    {% include 'linkPointsList.html' %}
                {% endwith %}
                {% endwith %}
              {% endwith %}
            </div>
      </div>

    </div> <!-- id="supportingPointsArea" class="tabbedArea"-->

  <div id="commentArea" class="tabbedArea">
    <div class="row">
      <div class="span10 offset1">      
        <div class="row">
            <button id="showAddComment">New Comment </button>
        </div>
      
        <div class="row">
          <div id="addComment" class="hide">
                  <textarea id="commentText" width="100%"
                   class="mceEditor textEdit" rows="3"                       
                   placeholder="Type your comment here..."></textarea>
                  <input id="rootUrlSafe" type="hidden" name="p" value="{{pointRoot.key.urlsafe}}" />            
                <div class="">
                  <button id='saveCommentSubmit' class="pull-right">Save Comment</button>
                </div>
           </div>
         </div>
         <div class="row">
           <ul id="comments">     
           {% for comment in comments %}
              <li class="cmmnt span10 level{{comment.level}}">
                <div class="avatar span1">
                    <a href="/user/{{comment.userUrl}}">
                        <img class="pull-left" src="{{comment.avatar_url}}" width="55" height="55"/>
                    </a>
                </div>
                <div class="cmmnt-content">
                  <a href="/user/{{comment.userUrl}}" class="userlink">{{comment.userName}}</a> 
                    - <span class="pubdate">{{comment.PSTdate}}</span>
                  {{comment.text|safe}}
                </div>
                <div class="span1 pull-right">
                    <a name="commentReply" data-parentkey="{{comment.key.urlsafe}}">Reply</a>
                </div>
              </li>
           {% endfor %}
           </ul>   
         </div>
       </div>
    </div>
     
  </div>
  

  <div id="historyArea" class="row tabbedArea">
    </div>


      <script>
      var myVote = '{{voteValue}}';
      var pointURL = '{{point.url}}';
      var thresholdGreen = {{ thresholds.green }};
      var thresholdRed = {{ thresholds.red }};
      </script>      
    
{% endblock %}
